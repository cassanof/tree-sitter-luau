## tree-sitter-luau

Parser for luau made with [tree-sitter](https://github.com/tree-sitter/tree-sitter)

## overview

The source is contained in [grammar.js](./grammar.js), along with a small [external scanner](./src/scanner.c).
The rest (notably `./src/parser.c`) is generated by `tree-sitter-cli`, which is listed on cargo or npm.

## example

input

```lua
--!nonstrict

type f64 = number
type nat = number

export type Matrix<M> = {
  add:      (A: M, B: M, params: Target<M>) -> M,
  mul:      (A: M, B: M, params: MulRange | Target<M>) -> M,
  sub:      (A: M, B: M, params: Target<M>) -> M,
  getRe:    (mat: M) -> M,
  getIm:    (mat: M) -> M,
  rslice:   (mat: M) -> ({f64}, {f64}),
  cslice:   (mat: M) -> ({f64}, {f64}),
  rsplice:  (mat: M, i: nat) -> ({f64}, {f64}),
  csplice:  (mat: M, j: nat) -> ({f64}, {f64}),
  clear:    (mat: M) -> (),
  trace:    (mat: M) -> (f64, f64),
}

export type Target<M> = {
  Target: M
}

export type MulRange = {
  R00: nat, R01: nat,
  R10: nat, R11: nat,
  C00: nat, C01: nat,
  C10: nat, C11: nat
}

return function(Sparsy, verbsm, structm)
  local structf = require(structm)
  local verbsf = require(verbsm)

  structf(Sparsy)
  verbsf(Sparsy)

  return this
end
```

output (`tree-sitter parse sparsy/module.luau`)
```
(chunk [0, 0] - [39, 0]
  (comment [0, 0] - [0, 12])
  (type_stmt [2, 0] - [2, 17]
    name: (name [2, 5] - [2, 8])
    (simpletype [2, 11] - [2, 17]
      typename: (name [2, 11] - [2, 17])))
  (type_stmt [3, 0] - [3, 17]
    name: (name [3, 5] - [3, 8])
    (simpletype [3, 11] - [3, 17]
      typename: (name [3, 11] - [3, 17])))
  (type_stmt [5, 0] - [17, 1]
    name: (name [5, 12] - [5, 18])
    generic: (name [5, 19] - [5, 20])
    (simpletype [5, 24] - [17, 1]
      prop: (name [6, 2] - [6, 5])
      value: (simpletype [6, 12] - [6, 48]
        (typefuncpar [6, 12] - [6, 46]
          param: (name [6, 13] - [6, 14])
          (simpletype [6, 16] - [6, 17]
            typename: (name [6, 16] - [6, 17]))
          param: (name [6, 19] - [6, 20])
          (simpletype [6, 22] - [6, 23]
            typename: (name [6, 22] - [6, 23]))
          param: (name [6, 25] - [6, 31])
          (simpletype [6, 33] - [6, 42]
            typename: (name [6, 33] - [6, 39])
            (typeparlist [6, 40] - [6, 41]
              (typepar [6, 40] - [6, 41]
                (simpletype [6, 40] - [6, 41]
                  typename: (name [6, 40] - [6, 41]))))))
        (typeret [6, 47] - [6, 48]
          (simpletype [6, 47] - [6, 48]
            typename: (name [6, 47] - [6, 48]))))
      prop: (name [7, 2] - [7, 5])
      value: (simpletype [7, 12] - [7, 59]
        (typefuncpar [7, 12] - [7, 57]
          param: (name [7, 13] - [7, 14])
          (simpletype [7, 16] - [7, 17]
            typename: (name [7, 16] - [7, 17]))
          param: (name [7, 19] - [7, 20])
          (simpletype [7, 22] - [7, 23]
            typename: (name [7, 22] - [7, 23]))
          param: (name [7, 25] - [7, 31])
          (bintype [7, 33] - [7, 53]
            arg0: (simpletype [7, 33] - [7, 41]
              typename: (name [7, 33] - [7, 41]))
            arg1: (simpletype [7, 44] - [7, 53]
              typename: (name [7, 44] - [7, 50])
              (typeparlist [7, 51] - [7, 52]
                (typepar [7, 51] - [7, 52]
                  (simpletype [7, 51] - [7, 52]
                    typename: (name [7, 51] - [7, 52])))))))
        (typeret [7, 58] - [7, 59]
          (simpletype [7, 58] - [7, 59]
            typename: (name [7, 58] - [7, 59]))))
      prop: (name [8, 2] - [8, 5])
      value: (simpletype [8, 12] - [8, 48]
        (typefuncpar [8, 12] - [8, 46]
          param: (name [8, 13] - [8, 14])
          (simpletype [8, 16] - [8, 17]
            typename: (name [8, 16] - [8, 17]))
          param: (name [8, 19] - [8, 20])
          (simpletype [8, 22] - [8, 23]
            typename: (name [8, 22] - [8, 23]))
          param: (name [8, 25] - [8, 31])
          (simpletype [8, 33] - [8, 42]
            typename: (name [8, 33] - [8, 39])
            (typeparlist [8, 40] - [8, 41]
              (typepar [8, 40] - [8, 41]
                (simpletype [8, 40] - [8, 41]
                  typename: (name [8, 40] - [8, 41]))))))
        (typeret [8, 47] - [8, 48]
          (simpletype [8, 47] - [8, 48]
            typename: (name [8, 47] - [8, 48]))))
      prop: (name [9, 2] - [9, 7])
      value: (simpletype [9, 12] - [9, 25]
        (typefuncpar [9, 12] - [9, 23]
          param: (name [9, 13] - [9, 16])
          (simpletype [9, 18] - [9, 19]
            typename: (name [9, 18] - [9, 19])))
        (typeret [9, 24] - [9, 25]
          (simpletype [9, 24] - [9, 25]
            typename: (name [9, 24] - [9, 25]))))
      prop: (name [10, 2] - [10, 7])
      value: (simpletype [10, 12] - [10, 25]
        (typefuncpar [10, 12] - [10, 23]
          param: (name [10, 13] - [10, 16])
          (simpletype [10, 18] - [10, 19]
            typename: (name [10, 18] - [10, 19])))
        (typeret [10, 24] - [10, 25]
          (simpletype [10, 24] - [10, 25]
            typename: (name [10, 24] - [10, 25]))))
      prop: (name [11, 2] - [11, 8])
      value: (simpletype [11, 12] - [11, 38]
        (typefuncpar [11, 12] - [11, 23]
          param: (name [11, 13] - [11, 16])
          (simpletype [11, 18] - [11, 19]
            typename: (name [11, 18] - [11, 19])))
        (typeret [11, 24] - [11, 38]
          (typepack [11, 24] - [11, 38]
            wrap: (typelist [11, 25] - [11, 37]
              (simpletype [11, 25] - [11, 30]
                (arraytype [11, 26] - [11, 29]
                  (simpletype [11, 26] - [11, 29]
                    typename: (name [11, 26] - [11, 29]))))
              (simpletype [11, 32] - [11, 37]
                (arraytype [11, 33] - [11, 36]
                  (simpletype [11, 33] - [11, 36]
                    typename: (name [11, 33] - [11, 36]))))))))
      prop: (name [12, 2] - [12, 8])
      value: (simpletype [12, 12] - [12, 38]
        (typefuncpar [12, 12] - [12, 23]
          param: (name [12, 13] - [12, 16])
          (simpletype [12, 18] - [12, 19]
            typename: (name [12, 18] - [12, 19])))
        (typeret [12, 24] - [12, 38]
          (typepack [12, 24] - [12, 38]
            wrap: (typelist [12, 25] - [12, 37]
              (simpletype [12, 25] - [12, 30]
                (arraytype [12, 26] - [12, 29]
                  (simpletype [12, 26] - [12, 29]
                    typename: (name [12, 26] - [12, 29]))))
              (simpletype [12, 32] - [12, 37]
                (arraytype [12, 33] - [12, 36]
                  (simpletype [12, 33] - [12, 36]
                    typename: (name [12, 33] - [12, 36]))))))))
      prop: (name [13, 2] - [13, 9])
      value: (simpletype [13, 12] - [13, 46]
        (typefuncpar [13, 12] - [13, 31]
          param: (name [13, 13] - [13, 16])
          (simpletype [13, 18] - [13, 19]
            typename: (name [13, 18] - [13, 19]))
          param: (name [13, 21] - [13, 22])
          (simpletype [13, 24] - [13, 27]
            typename: (name [13, 24] - [13, 27])))
        (typeret [13, 32] - [13, 46]
          (typepack [13, 32] - [13, 46]
            wrap: (typelist [13, 33] - [13, 45]
              (simpletype [13, 33] - [13, 38]
                (arraytype [13, 34] - [13, 37]
                  (simpletype [13, 34] - [13, 37]
                    typename: (name [13, 34] - [13, 37]))))
              (simpletype [13, 40] - [13, 45]
                (arraytype [13, 41] - [13, 44]
                  (simpletype [13, 41] - [13, 44]
                    typename: (name [13, 41] - [13, 44]))))))))
      prop: (name [14, 2] - [14, 9])
      value: (simpletype [14, 12] - [14, 46]
        (typefuncpar [14, 12] - [14, 31]
          param: (name [14, 13] - [14, 16])
          (simpletype [14, 18] - [14, 19]
            typename: (name [14, 18] - [14, 19]))
          param: (name [14, 21] - [14, 22])
          (simpletype [14, 24] - [14, 27]
            typename: (name [14, 24] - [14, 27])))
        (typeret [14, 32] - [14, 46]
          (typepack [14, 32] - [14, 46]
            wrap: (typelist [14, 33] - [14, 45]
              (simpletype [14, 33] - [14, 38]
                (arraytype [14, 34] - [14, 37]
                  (simpletype [14, 34] - [14, 37]
                    typename: (name [14, 34] - [14, 37]))))
              (simpletype [14, 40] - [14, 45]
                (arraytype [14, 41] - [14, 44]
                  (simpletype [14, 41] - [14, 44]
                    typename: (name [14, 41] - [14, 44]))))))))
      prop: (name [15, 2] - [15, 7])
      value: (simpletype [15, 12] - [15, 26]
        (typefuncpar [15, 12] - [15, 23]
          param: (name [15, 13] - [15, 16])
          (simpletype [15, 18] - [15, 19]
            typename: (name [15, 18] - [15, 19])))
        (typeret [15, 24] - [15, 26]
          (typepack [15, 24] - [15, 26])))
      prop: (name [16, 2] - [16, 7])
      value: (simpletype [16, 12] - [16, 34]
        (typefuncpar [16, 12] - [16, 23]
          param: (name [16, 13] - [16, 16])
          (simpletype [16, 18] - [16, 19]
            typename: (name [16, 18] - [16, 19])))
        (typeret [16, 24] - [16, 34]
          (typepack [16, 24] - [16, 34]
            wrap: (typelist [16, 25] - [16, 33]
              (simpletype [16, 25] - [16, 28]
                typename: (name [16, 25] - [16, 28]))
              (simpletype [16, 30] - [16, 33]
                typename: (name [16, 30] - [16, 33]))))))))
  (type_stmt [19, 0] - [21, 1]
    name: (name [19, 12] - [19, 18])
    generic: (name [19, 19] - [19, 20])
    (simpletype [19, 24] - [21, 1]
      prop: (name [20, 2] - [20, 8])
      value: (simpletype [20, 10] - [20, 11]
        typename: (name [20, 10] - [20, 11]))))
  (type_stmt [23, 0] - [28, 1]
    name: (name [23, 12] - [23, 20])
    (simpletype [23, 23] - [28, 1]
      prop: (name [24, 2] - [24, 5])
      value: (simpletype [24, 7] - [24, 10]
        typename: (name [24, 7] - [24, 10]))
      prop: (name [24, 12] - [24, 15])
      value: (simpletype [24, 17] - [24, 20]
        typename: (name [24, 17] - [24, 20]))
      prop: (name [25, 2] - [25, 5])
      value: (simpletype [25, 7] - [25, 10]
        typename: (name [25, 7] - [25, 10]))
      prop: (name [25, 12] - [25, 15])
      value: (simpletype [25, 17] - [25, 20]
        typename: (name [25, 17] - [25, 20]))
      prop: (name [26, 2] - [26, 5])
      value: (simpletype [26, 7] - [26, 10]
        typename: (name [26, 7] - [26, 10]))
      prop: (name [26, 12] - [26, 15])
      value: (simpletype [26, 17] - [26, 20]
        typename: (name [26, 17] - [26, 20]))
      prop: (name [27, 2] - [27, 5])
      value: (simpletype [27, 7] - [27, 10]
        typename: (name [27, 7] - [27, 10]))
      prop: (name [27, 12] - [27, 15])
      value: (simpletype [27, 17] - [27, 20]
        typename: (name [27, 17] - [27, 20]))))
  (ret_stmt [30, 0] - [38, 3]
    (explist [30, 7] - [38, 3]
      (callback [30, 7] - [38, 3]
        parameters: (parlist [30, 16] - [30, 39]
          binding: (binding [30, 16] - [30, 22]
            name: (name [30, 16] - [30, 22]))
          binding: (binding [30, 24] - [30, 30]
            name: (name [30, 24] - [30, 30]))
          binding: (binding [30, 32] - [30, 39]
            name: (name [30, 32] - [30, 39])))
        body: (block [31, 2] - [37, 13]
          (local_var_stmt [31, 2] - [31, 34]
            (bindinglist [31, 8] - [31, 15]
              (binding [31, 8] - [31, 15]
                name: (name [31, 8] - [31, 15])))
            (explist [31, 18] - [31, 34]
              (call_stmt [31, 18] - [31, 34]
                invoked: (var [31, 18] - [31, 25]
                  (name [31, 18] - [31, 25]))
                arglist: (arglist [31, 25] - [31, 34]
                  (explist [31, 26] - [31, 33]
                    (var [31, 26] - [31, 33]
                      (name [31, 26] - [31, 33])))))))
          (local_var_stmt [32, 2] - [32, 32]
            (bindinglist [32, 8] - [32, 14]
              (binding [32, 8] - [32, 14]
                name: (name [32, 8] - [32, 14])))
            (explist [32, 17] - [32, 32]
              (call_stmt [32, 17] - [32, 32]
                invoked: (var [32, 17] - [32, 24]
                  (name [32, 17] - [32, 24]))
                arglist: (arglist [32, 24] - [32, 32]
                  (explist [32, 25] - [32, 31]
                    (var [32, 25] - [32, 31]
                      (name [32, 25] - [32, 31])))))))
          (call_stmt [34, 2] - [34, 17]
            invoked: (var [34, 2] - [34, 9]
              (name [34, 2] - [34, 9]))
            arglist: (arglist [34, 9] - [34, 17]
              (explist [34, 10] - [34, 16]
                (var [34, 10] - [34, 16]
                  (name [34, 10] - [34, 16])))))
          (call_stmt [35, 2] - [35, 16]
            invoked: (var [35, 2] - [35, 8]
              (name [35, 2] - [35, 8]))
            arglist: (arglist [35, 8] - [35, 16]
              (explist [35, 9] - [35, 15]
                (var [35, 9] - [35, 15]
                  (name [35, 9] - [35, 15])))))
          (ret_stmt [37, 2] - [37, 13]
            (explist [37, 9] - [37, 13]
              (var [37, 9] - [37, 13]
                (name [37, 9] - [37, 13])))))))))
```
